<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Senior Citizen Dues Tracker</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Poppins', 'sans-serif'] },
          colors: {
            mint: { 50:'#f0fdf4', 100:'#dcfce7', 500:'#10b981', 600:'#059669', 700:'#047857' },
            gold: { 400:'#fbbf24', 500:'#f59e0b', 600:'#d97706' }
          }
        }
      }
    }
  </script>

  <style>
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

    .sidebar-transition { transition: transform 0.3s ease-in-out; }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    body { -webkit-tap-highlight-color: transparent; }
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body class="bg-mint-50 text-slate-800 font-sans h-screen flex overflow-hidden">

  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black/50 z-20 hidden lg:hidden backdrop-blur-sm transition-opacity"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-white shadow-2xl z-30 transform -translate-x-full lg:translate-x-0 lg:static flex flex-col border-r border-mint-100 sidebar-transition">
    <div class="h-16 flex items-center justify-center border-b border-mint-100 bg-mint-500 text-white">
      <div class="flex items-center gap-2 font-bold text-xl">
        <i data-lucide="users" class="w-6 h-6"></i>
        <span>SeniorTracker</span>
      </div>
    </div>

    <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
      <button id="nav-input" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-mint-700 bg-mint-100 shadow-sm ring-1 ring-mint-200">
        <i data-lucide="pen-tool" class="w-5 h-5"></i>
        Data Entry
      </button>
      <button id="nav-summary" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-slate-500 hover:bg-slate-50 hover:text-mint-600">
        <i data-lucide="file-bar-chart" class="w-5 h-5"></i>
        Summary List
      </button>
    </nav>

    <div class="p-4 border-t border-mint-100 text-xs text-center text-slate-400">
      <p>&copy; 2026 Community App</p>
    </div>
  </aside>

  <!-- Main -->
  <div class="flex-1 flex flex-col h-full w-full relative">
    
    <!-- Mobile Header -->
    <header class="h-16 bg-white border-b border-mint-100 flex items-center justify-between px-4 lg:hidden shrink-0 z-10">
      <button id="menu-btn" class="p-2 text-mint-700 hover:bg-mint-50 rounded-lg">
        <i data-lucide="menu" class="w-6 h-6"></i>
      </button>
      <span class="font-bold text-lg text-mint-700">Senior Dues</span>
      <div class="w-10"></div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 lg:p-8 scroll-smooth relative">

      <!-- Loading -->
      <div id="loading" class="absolute inset-0 flex flex-col items-center justify-center bg-mint-50 z-50 text-mint-600">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-current mb-4"></div>
        <p class="animate-pulse font-medium">Loading Database...</p>
      </div>

      <!-- Input Form -->
      <section id="view-input" class="max-w-2xl mx-auto fade-in">
        <div class="bg-white rounded-2xl shadow-sm border border-mint-100 overflow-hidden">
          <div class="bg-mint-500 p-6 text-white flex justify-between items-center">
            <div>
              <h2 id="form-title" class="text-xl font-bold flex items-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> New Entry
              </h2>
              <p class="text-mint-100 text-sm mt-1">Record monthly contributions</p>
            </div>
            <button id="cancel-edit" class="hidden text-xs bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full text-white transition">Cancel Edit</button>
          </div>
          
          <div class="p-6 space-y-6">
            <input type="hidden" id="doc-id">

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Purok No.</label>
                <input id="purok" type="number" placeholder="e.g. 1" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-mint-500 focus:ring-2 focus:ring-mint-200 outline-none transition-all bg-slate-50 focus:bg-white">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Senior Name</label>
                <input id="name" type="text" placeholder="Last Name, First Name" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-mint-500 focus:ring-2 focus:ring-mint-200 outline-none transition-all bg-slate-50 focus:bg-white">
              </div>
            </div>

            <div class="bg-gold-500/10 p-5 rounded-xl border border-gold-500/20">
              <h3 class="text-gold-600 font-bold text-sm uppercase tracking-wider mb-4 flex items-center gap-2">
                <i data-lucide="coins" class="w-4 h-4"></i> Contributions (PHP)
              </h3>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-xs font-medium text-slate-500 mb-1">2023</label>
                  <input id="y2023" type="number" placeholder="0" class="w-full px-3 py-2 rounded-lg border border-gold-500/30 focus:border-gold-500 focus:ring-2 focus:ring-gold-500/20 outline-none text-right font-mono">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-500 mb-1">2024</label>
                  <input id="y2024" type="number" placeholder="0" class="w-full px-3 py-2 rounded-lg border border-gold-500/30 focus:border-gold-500 focus:ring-2 focus:ring-gold-500/20 outline-none text-right font-mono">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-500 mb-1">2025</label>
                  <input id="y2025" type="number" placeholder="0" class="w-full px-3 py-2 rounded-lg border border-gold-500/30 focus:border-gold-500 focus:ring-2 focus:ring-gold-500/20 outline-none text-right font-mono">
                </div>
              </div>
            </div>

            <button id="save-btn" class="w-full bg-gold-500 hover:bg-gold-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-gold-500/30 flex items-center justify-center gap-2">
              <i data-lucide="save" class="w-5 h-5"></i>
              <span>Save Record</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Summary -->
      <section id="view-summary" class="hidden fade-in h-full flex flex-col">
        <div class="flex flex-col md:flex-row gap-4 mb-6 items-center justify-between">
          <h2 class="text-2xl font-bold text-mint-700">Records</h2>
          <div class="flex gap-2 w-full md:w-auto">
            <div class="relative flex-1 md:w-64">
              <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
              <input id="search-input" type="text" placeholder="Search name..." class="w-full pl-9 pr-4 py-2 rounded-lg border border-slate-200 focus:border-mint-500 focus:ring-2 focus:ring-mint-200 outline-none text-sm">
            </div>
            <button onclick="window.print()" class="bg-white text-slate-600 border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 flex items-center gap-2">
              <i data-lucide="printer" class="w-4 h-4"></i>
              <span class="hidden sm:inline">Print</span>
            </button>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-mint-100 overflow-hidden flex-1">
          <div class="overflow-x-auto">
            <table class="w-full text-left text-sm min-w-max">
              <thead class="bg-mint-50 text-mint-800 border-b border-mint-100">
                <tr>
                  <th class="p-4 font-semibold">Purok</th>
                  <th class="p-4 font-semibold">Name</th>
                  <th class="p-4 text-right">2023</th>
                  <th class="p-4 text-right">2024</th>
                  <th class="p-4 text-right">2025</th>
                  <th class="p-4 text-right font-bold text-gold-600">Total</th>
                  <th class="p-4 text-center no-print">Edit</th>
                </tr>
              </thead>
              <tbody id="table-body" class="divide-y divide-slate-100"></tbody>
            </table>
          </div>
          <div id="empty-state" class="hidden p-8 text-center text-slate-400">
            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
            <p>No records found.</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Firebase & App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAL3lrszwjehY8gANXjyMyMVx4-X9Xsc_E",
      authDomain: "senior-citizen-dues-tracker.firebaseapp.com",
      projectId: "senior-citizen-dues-tracker",
      storageBucket: "senior-citizen-dues-tracker.firebasestorage.app",
      messagingSenderId: "276183327912",
      appId: "1:276183327912:web:786cfbf3dcfc1aea45ce9d",
      measurementId: "G-KGVWPFQ6V7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let uid;
    let cachedData = [];

    const loadingEl = document.getElementById('loading');
    const menuBtn = document.getElementById('menu-btn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const navInput = document.getElementById('nav-input');
    const navSummary = document.getElementById('nav-summary');
    const viewInput = document.getElementById('view-input');
    const viewSummary = document.getElementById('view-summary');
    const formTitle = document.getElementById('form-title');
    const docIdField = document.getElementById('doc-id');
    const cancelEditBtn = document.getElementById('cancel-edit');
    const saveBtn = document.getElementById('save-btn');
    const saveBtnText = saveBtn.querySelector('span');
    const inputPurok = document.getElementById('purok');
    const inputName = document.getElementById('name');
    const inputY23 = document.getElementById('y2023');
    const inputY24 = document.getElementById('y2024');
    const inputY25 = document.getElementById('y2025');
    const searchInput = document.getElementById('search-input');

    signInAnonymously(auth);
    onAuthStateChanged(auth, user => {
      if (!user) return;
      uid = user.uid;
      loadingEl.classList.add('hidden');
      lucide.createIcons();
    });

    // Hamburger toggle
    menuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    });

    overlay.addEventListener('click', () => {
      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    });

    function switchTab(tab) {
      if (window.innerWidth < 1024) {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
      }
      if(tab==='input'){
        viewInput.classList.remove('hidden'); viewSummary.classList.add('hidden');
        navInput.className = "w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-mint-700 bg-mint-100 shadow-sm ring-1 ring-mint-200";
        navSummary.className = "w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-slate-500 hover:bg-slate-50 hover:text-mint-600";
      } else {
        viewInput.classList.add('hidden'); viewSummary.classList.remove('hidden');
        navSummary.className = "w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-mint-700 bg-mint-100 shadow-sm ring-1 ring-mint-200";
        navInput.className = "w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all text-slate-500 hover:bg-slate-50 hover:text-mint-600";
        loadTable();
      }
    }

    navInput.onclick = () => switchTab('input');
    navSummary.onclick = () => switchTab('summary');

    function getCollection(){ return collection(db,'artifacts','senior-citizen-dues-tracker','public','data','senior_dues'); }

    saveBtn.onclick = async()=>{
      const docId = docIdField.value;
      const data={purok:inputPurok.value,name:inputName.value,y2023:Number(inputY23.value)||0,y2024:Number(inputY24.value)||0,y2025:Number(inputY25.value)||0};
      if(!data.purok||!data.name)return alert('Name and Purok required.');
      saveBtn.disabled=true; saveBtnText.innerText="Processing...";
      try{
        if(docId){
          const docRef=doc(db,'artifacts','senior-citizen-dues-tracker','public','data','senior_dues',docId);
          await updateDoc(docRef,data); alert('Updated!'); resetForm(); switchTab('summary');
        } else {
          await addDoc(getCollection(),data); alert('Saved!'); resetForm();
        }
      } catch(err){ console.error(err); alert('Error saving. Check Firebase rules or connection.'); }
      finally{ saveBtn.disabled=false; saveBtnText.innerText=docId?"Update Record":"Save Record"; }
    };

    async function loadTable(){
      const tbody=document.getElementById('table-body');
      const emptyState=document.getElementById('empty-state');
      tbody.innerHTML='<tr><td colspan="7" class="p-8 text-center"><div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-mint-500"></div></td></tr>';
      const snap=await getDocs(getCollection());
      cachedData=[];
      snap.forEach(d=>cachedData.push({id:d.id,...d.data()}));
      cachedData.sort((a,b)=>a.purok-b.purok);
      renderTable(cachedData);
    }

    function renderTable(data){
      const tbody=document.getElementById('table-body');
      const emptyState=document.getElementById('empty-state');
      tbody.innerHTML='';
      if(!data.length){ emptyState.classList.remove('hidden'); return; } emptyState.classList.add('hidden');
      data.forEach(d=>{
        const tr=document.createElement('tr');
        tr.className='hover:bg-mint-50 transition';
        const total=(d.y2023||0)+(d.y2024||0)+(d.y2025||0);
        tr.innerHTML=`
          <td class="p-4">${d.purok}</td>
          <td class="p-4">${d.name}</td>
          <td class="p-4 text-right">${d.y2023||0}</td>
          <td class="p-4 text-right">${d.y2024||0}</td>
          <td class="p-4 text-right">${d.y2025||0}</td>
          <td class="p-4 text-right font-bold text-gold-600">${total}</td>
          <td class="p-4 text-center no-print"><button class="text-mint-500 hover:text-mint-700" onclick="editRecord('${d.id}')"><i data-lucide="edit-2" class="w-4 h-4"></i></button></td>`;
        tbody.appendChild(tr);
      });
      lucide.createIcons();
    }

    function editRecord(id){
      const data=cachedData.find(x=>x.id===id);
      if(!data)return;
      switchTab('input');
      docIdField.value=data.id;
      inputPurok.value=data.purok;
      inputName.value=data.name;
      inputY23.value=data.y2023||0;
      inputY24.value=data.y2024||0;
      inputY25.value=data.y2025||0;
      cancelEditBtn.classList.remove('hidden');
      formTitle.innerText='Edit Record';
      saveBtnText.innerText='Update Record';
    }

    cancelEditBtn.onclick = resetForm;

    function resetForm(){
      docIdField.value='';
      inputPurok.value='';
      inputName.value='';
      inputY23.value=''; inputY24.value=''; inputY25.value='';
      cancelEditBtn.classList.add('hidden');
      formTitle.innerText='New Entry';
      saveBtnText.innerText='Save Record';
    }

    searchInput.addEventListener('input',()=>{
      const query=searchInput.value.toLowerCase();
      const filtered=cachedData.filter(d=>d.name.toLowerCase().includes(query));
      renderTable(filtered);
    });

    // Auto-close sidebar when nav item clicked on mobile
    document.querySelectorAll('#sidebar nav button').forEach(btn=>{
      btn.addEventListener('click', () => {
        if(window.innerWidth<1024){
          sidebar.classList.add('-translate-x-full');
          overlay.classList.add('hidden');
        }
      });
    });

  </script>

  <script>lucide.createIcons();</script>
</body>
</html>
